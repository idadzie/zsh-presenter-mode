#!/usr/bin/env bash

set -o pipefail

# https://superuser.com/questions/157563/programmatic-access-to-current-xterm-background-color

if [[ -n $TMUX ]]; then
  echo -e '\nSorry. Tmux does not support backgroud color xterm control sequence.'

  # Return 1 when sourced & exit when run as executable.
  if [[ ${BASH_SOURCE[0]} != "${0}" ]]; then
    return 1
  else
    exit 1
  fi
fi

oldstty=$(stty -g)

stty raw -echo min 0 time 0
printf "\033]11;?\033\\"
sleep 0.00000001
result=''
if IFS=';' read -r -d '\' color; then
  result=$(echo $color | sed 's/^.*\;//;s/[^rgb:0-9a-f/]//g')
fi
stty $oldstty
echo $result
